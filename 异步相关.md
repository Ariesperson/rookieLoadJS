# 异步(Promise)

异步包括：fs文件操作、数据库操作、Ajax、定时器

## Promise

​	`Promise`对象代表一个异步操作，有三种状态：`pending`（进行中）、`fulfilled`（已成功）和`rejected`（已失败）

一个 `Promise` 必然处于以下几种状态之一 👇：

- 待定 `(pending)`: 初始状态，既没有被兑现，也没有被拒绝。
- 已成功 `(fulfilled)`: 意味着操作成功完成。
- 已拒绝 `(rejected)`: 意味着操作失败。

```javascript
let p1 = new Promise((resolve, reject) => {
    resolve('成功')
    reject('失败')
})
console.log('p1', p1) //promise对象  PromiseState:'fulfilled' PromiseResult:'成功'

let p2 = new Promise((resolve, reject) => {
    reject('失败')
    resolve('成功')
})
console.log('p2', p2)//promise对象  PromiseState:'rejected' PromiseResult:'失败'

let p3 = new Promise((resolve, reject) => {
    throw('报错')
})
console.log('p3', p3)//promise对象  PromiseState:'rejected' PromiseResult:'报错'
```

1、执行了`resolve()`，Promise状态会变成`fulfilled`，即 **已完成状态**

2、执行了`reject()`，Promise状态会变成`rejected`，即 **被拒绝状态**

3、Promise只以`第一次为准`，第一次成功就`永久`为`fulfilled`，第一次失败就永远状态为`rejected`

4、Promise中有`throw`的话，就相当于执行了`reject()`

```javascript
let myPromise1 = new Promise(() => {});

console.log('myPromise1 :>> ', myPromise1);
//promise对象  PromiseState:'pending' PromiseResult:'undefined'

let myPromise2 = new Promise((resolve, reject) => {
    let a = 1;
    for (let index = 0; index < 5; index++) {
        a++;
    }
})

console.log('myPromise2 :>> ', myPromise2) 
//promise对象  PromiseState:'pending' PromiseResult:'undefined'

myPromise2.then(() => {
    console.log("myPromise2执行了then");
})

```

- 1、Promise的初始状态是`pending`
- 2、Promise里没有执行`resolve()`、`reject()`以及`throw`的话，这个**promise的状态也是`pending`**
- 3、基于上一条，`pending`状态下的promise不会执行回调函数`then()`

```javascript
let myPromise0 = new Promise();
console.log('myPromise0 :>> ', myPromise0);
// Uncaught TypeError: Promise resolver undefined is not a function
// 规定必须给Promise对象传入一个执行函数，否则将会报错。
```

## 实现Promise

1.创建类，定义初始结构

2.实现resolve和reject:

​	a.管理状态和结果：pending、fulfilled和rejected:

- 初始的时候是`pending`
- `pending`可以转为`fulfilled`状态，但是不能逆转
- `pending`也可以转为`rejected`状态，但是也不能逆转
- 这里`fulfilled`和`rejected`也不能互转

   b.执行 resolve() 和 reject() 可以传参

```javascript

class myPromise{
    static PENDING = 'pending'
    static FULFILLED = 'fulfilled'
    static REJECTED = 'rejected'
   //需要在类的构造函数constructor里面添加一个参数，这里就用func来做形参，并且执行一下这个参数
    constructor(func){
        this.PromiseState = myPromise.PENDING//初始的时候是pending状态
        func(this.resolve,this.reject);;
    }
    resolve(result){
        //那么在执行resolve()的时候就需要判断状态是否为 待定 pending，如果是 待定 pending的话就			把状态改为 成功 fulfilled:
        if(this.PromiseState === myPromise.PENDING){
           this.PromiseState = myPromise.FULFILLED;
           // resolve()添加参数，并且把参数赋值给实例的PromiseResult属性
           this.PromiseResult = result; 
        }
    }
    reject(reason){
      	//为给reject添加参数，并且把参数赋值给实例的PromiseResult属性:
        if (this.PromiseState === myPromise.PENDING) {
          this.PromiseState = myPromise.REJECT;
          //为给reject()添加参数，并且把参数赋值给实例的PromiseResult属性
          this.PromiseResult = reason;
        }
    }
}

```



